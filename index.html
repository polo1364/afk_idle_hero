<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AFK Idle Hero | æ›æ©Ÿå§ï¼å‹‡è€…ï¼ˆå–®æª”åŸå‹ï¼‰</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#121a2b; --muted:#8aa0c6; --text:#e9f0ff; --accent:#6ec7ff; --accent2:#8bffb0; --danger:#ff6e86;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans TC',sans-serif;background:linear-gradient(180deg,#0b1220,#0b1220 50%,#0e1527);color:var(--text)}
    header{position:sticky;top:0;background:#0b1220d0;backdrop-filter:saturate(140%) blur(6px);z-index:10;border-bottom:1px solid #1d2a45}
    header .wrap{max-width:1100px;margin:auto;padding:10px 14px;display:flex;gap:12px;align-items:center}
    .title{font-weight:800;letter-spacing:0.5px}
    .pill{padding:4px 10px;border:1px solid #2b3b63;border-radius:999px;color:var(--muted);font-size:12px}
    main{max-width:1100px;margin:auto;padding:16px}
    .grid{display:grid;grid-template-columns:1.2fr 1fr;gap:16px}
    @media (max-width:900px){.grid{grid-template-columns:1fr;}}
    .card{background:var(--panel);border:1px solid #1d2a45;border-radius:14px;box-shadow:0 6px 24px #0006}
    .card h3{margin:0 0 10px 0;font-size:16px;color:#bcd2ff}
    .card .body{padding:14px}
    .bar{height:14px;background:#0a1324;border:1px solid #1d2a45;border-radius:999px;overflow:hidden}
    .bar>div{height:100%;background:linear-gradient(90deg,#67bfff,#8bffb0);width:0%;transition:width .25s ease}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .col{display:flex;flex-direction:column;gap:6px}
    button{background:#162446;border:1px solid #2b3b63;color:#cfe3ff;padding:8px 10px;border-radius:10px;cursor:pointer}
    button:hover{filter:brightness(1.08)}
    .btn-acc{border-color:#3c7bff;background:#17305a}
    .btn-danger{border-color:#6b2b3c;background:#3a0f18;color:#ffd4db}
    .muted{color:var(--muted)}
    .stat{display:grid;grid-template-columns:1fr auto;gap:6px;font-size:14px}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .kpi .box{padding:10px;border:1px solid #1d2a45;border-radius:12px;text-align:center;background:#0f1830}
    .tabs{display:flex;gap:6px;flex-wrap:wrap}
    .tabs button{padding:8px 12px}
    .tabs button.active{outline:2px solid #3c7bff}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 6px;border-bottom:1px solid #1d2a45;font-size:14px}
    th{color:#bcd2ff;text-align:left}
    .rarity-Common{color:#cfe3ff}
    .rarity-Uncommon{color:#8bffb0}
    .rarity-Rare{color:#6ec7ff}
    .rarity-Epic{color:#d9a7ff}
    .rarity-Legendary{color:#ffd37a}
    .footer{opacity:.7;font-size:12px;margin-top:8px}
    .log{max-height:160px;overflow:auto;background:#0b1327;padding:8px;border-radius:10px;border:1px solid #1d2a45}
    .right .body{display:flex;flex-direction:column;gap:10px}
    .small{font-size:12px}
    .danger{color:var(--danger)}
    .success{color:var(--accent2)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">ğŸ—¡ï¸ æ›æ©Ÿå§ï¼å‹‡è€… â€” åŸå‹</div>
      <div class="pill" id="pill-stage">Stage 1</div>
      <div class="pill" id="pill-gold">Gold 0</div>
      <div class="pill" id="pill-relic">Relics 0</div>
      <div class="pill" id="pill-dps">DPS 0</div>
      <div style="margin-left:auto" class="muted small">è‡ªå‹•å„²å­˜ä¸­ â€¢ å–®æ©Ÿç‰ˆåŸå‹ï¼ˆLocalStorageï¼‰</div>
    </div>
  </header>

  <main class="grid">
    <section class="left card">
      <div class="body">
        <div class="kpi" style="margin-bottom:10px">
          <div class="box"><div class="muted small">ç•¶å‰æ•µäºº</div><div id="kEnemy">Slime</div></div>
          <div class="box"><div class="muted small">æ•µäººè¡€é‡</div><div id="kEnemyHP">0 / 0</div></div>
          <div class="box"><div class="muted small">æˆ°é¬¥ç‹€æ…‹</div><div id="kStatus">å‰é€²ä¸­</div></div>
        </div>
        <div class="bar" title="Enemy HP"><div id="hpBar"></div></div>
        <div class="row" style="margin-top:10px">
          <button class="btn-acc" id="btnStart">â–¶ é–‹å§‹ / æš«åœ</button>
          <button id="btnFast">â© åŠ é€Ÿ Ã—<span id="speedLabel">1</span></button>
          <button id="btnNext">â­ ä¸‹ä¸€é—œ</button>
          <button id="btnRetry">âŸ² é‡è©¦Boss</button>
        </div>
        <div class="row" style="margin-top:12px;gap:14px">
          <div class="col" style="min-width:240px;flex:1">
            <h3>è‹±é›„å±¬æ€§</h3>
            <div class="stat"><div>ç­‰ç´š</div><div id="sLevel">1</div></div>
            <div class="stat"><div>æ”»æ“ŠåŠ›</div><div id="sATK">10</div></div>
            <div class="stat"><div>æš´æ“Šç‡</div><div id="sCrit">5%</div></div>
            <div class="stat"><div>æš´æ“Šå‚·å®³</div><div id="sCritDmg">200%</div></div>
            <div class="stat"><div>æ”»é€Ÿï¼ˆæ¬¡/ç§’ï¼‰</div><div id="sAS">1.00</div></div>
            <div class="stat"><div>éºç‰©åŠ æˆ</div><div id="sRelic">0%</div></div>
            <div class="stat"><div>å¯¦éš›DPS</div><div id="sDPS">0</div></div>
            <div class="row" style="margin-top:8px">
              <button id="btnBuyATK">å‡ç´šæ”»æ“Š +1ï¼ˆ<span id="costATK">10</span> é‡‘å¹£ï¼‰</button>
              <button id="btnBuyCrit">å‡ç´šæš´æ“Šç‡ +1%ï¼ˆ<span id="costCrit">25</span> é‡‘å¹£ï¼‰</button>
              <button id="btnBuyAS">å‡ç´šæ”»é€Ÿ +0.1ï¼ˆ<span id="costAS">50</span> é‡‘å¹£ï¼‰</button>
            </div>
          </div>
          <div class="col" style="min-width:260px;flex:1">
            <h3>è£å‚™ï¼ˆé»é¸ä»¥è£å‚™ï¼‰</h3>
            <table id="gearTable">
              <thead><tr><th>éƒ¨ä½</th><th>åç¨±</th><th>åŠ æˆ</th></tr></thead>
              <tbody>
                <tr><td>æ­¦å™¨</td><td id="gear-weapon">ç„¡</td><td id="gear-weapon-bonus">â€”</td></tr>
                <tr><td>è­·ç”²</td><td id="gear-armor">ç„¡</td><td id="gear-armor-bonus">â€”</td></tr>
                <tr><td>é£¾å“</td><td id="gear-trinket">ç„¡</td><td id="gear-trinket-bonus">â€”</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        <div style="margin-top:12px">
          <h3>æˆ°æ³ç´€éŒ„</h3>
          <div id="log" class="log small"></div>
        </div>
      </div>
    </section>

    <aside class="right card">
      <div class="body">
        <div class="tabs">
          <button data-tab="inv" class="active">ğŸ’ èƒŒåŒ…</button>
          <button data-tab="upg">â¬†ï¸ å¼·åŒ–</button>
          <button data-tab="prestige">ğŸŒ€ è½‰ç”Ÿ</button>
          <button data-tab="opts">âš™ï¸ è¨­å®š</button>
        </div>
        <div id="tab-inv" class="tab">
          <div class="muted small" style="margin-top:4px">æ“Šæ•—æ•µäººæœ‰æ©Ÿç‡æ‰è½è£å‚™ã€‚é»æ“Šç‰©å“å³å¯è£å‚™åˆ°å°æ‡‰éƒ¨ä½ã€‚</div>
          <table id="invTable" style="margin-top:8px">
            <thead><tr><th>åç¨±</th><th>éƒ¨ä½</th><th>åŠ æˆ</th><th>ç¨€æœ‰åº¦</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="tab-upg" class="tab" style="display:none">
          <h3>è¢«å‹•å¼·åŒ–</h3>
          <div class="row">
            <button id="btnAtk10" class="btn-acc">ä¸€æ¬¡å‡ç´šæ”»æ“Š +10ï¼ˆ<span id="costATK10">0</span>ï¼‰</button>
            <button id="btnAscSpd" title="æå‡æˆ°é¬¥é€Ÿåº¦ä¸Šé™">è§£é–æ›´å¿«åŠ é€Ÿ Ã—4ï¼ˆ500 é‡‘å¹£ï¼‰</button>
          </div>
          <div class="footer">å°æç¤ºï¼šæ¨é€²åˆ° 10 çš„å€æ•¸æœƒé‡åˆ° Bossï¼ˆ30 ç§’é™æ™‚ï¼‰ã€‚</div>
        </div>
        <div id="tab-prestige" class="tab" style="display:none">
          <h3>è½‰ç”Ÿï¼ˆAscendï¼‰</h3>
          <p class="muted">é‡ç½®è‡³ç¬¬ 1 é—œä¸¦å¤±å»é‡‘å¹£èˆ‡è£å‚™ï¼Œç²å¾— <b>éºç‰©</b> æå‡æ°¸ä¹…æ”»æ“ŠåŠ æˆï¼ˆæ¯æš +2%ï¼‰ã€‚éºç‰©æ•¸é‡å–æ±ºæ–¼ä½ é”æˆçš„æœ€é«˜é—œå¡ã€‚</p>
          <div class="row">
            <button id="btnAscend" class="btn-danger">ç«‹å³è½‰ç”Ÿï¼ˆç²å¾— <span id="relicPreview">0</span> éºç‰©ï¼‰</button>
          </div>
          <div class="footer">å…¬å¼ï¼šå¯ç²éºç‰© = âŒŠæœ€é«˜é—œ/20âŒ‹</div>
        </div>
        <div id="tab-opts" class="tab" style="display:none">
          <h3>è¨­å®šèˆ‡å­˜æª”</h3>
          <div class="row" style="gap:8px;flex-wrap:wrap">
            <button id="btnSave">ğŸ’¾ ç«‹å³å„²å­˜</button>
            <button id="btnExport">â¬‡ï¸ åŒ¯å‡ºå­˜æª”</button>
            <button id="btnImport">â¬†ï¸ åŒ¯å…¥å­˜æª”</button>
            <button id="btnWipe" class="btn-danger">ğŸ—‘ï¸ æ¸…é™¤å­˜æª”</button>
          </div>
          <div class="footer">é›¢ç·šæ”¶ç›Šï¼šæœ€å¤šè¨ˆç®— 8 å°æ™‚ã€‚æ¯ 10 ç§’è‡ªå‹•å„²å­˜ä¸€æ¬¡ã€‚</div>
        </div>
      </div>
    </aside>
  </main>

  <script>
  // ===== å·¥å…·å‡½å¼ =====
  const fmt = (n)=>Number(n).toLocaleString();
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
  const rand=(a,b)=>Math.random()*(b-a)+a;
  const choice=(arr)=>arr[Math.floor(Math.random()*arr.length)];

  // ===== éŠæˆ²ç‹€æ…‹ =====
  let G = {
    version:'0.2.0',
    running:true,
    speed:1,
    speedMax:2,
    gold:0,
    stage:1,
    bestStage:1,
    relics:0,
    hero:{ lvl:1, atk:10, crit:5, critDmg:200, atkSpd:1.0 },
    equip:{ weapon:null, armor:null, trinket:null },
    inv:[],
    enemy:null,
    bossTimer:0,
    lastTick: Date.now(),
    lastSave: Date.now()
  };

  const RARITY = [
    {name:'Common',    w:60, mult:1.00},
    {name:'Uncommon',  w:25, mult:1.15},
    {name:'Rare',      w:10, mult:1.35},
    {name:'Epic',      w:4,  mult:1.70},
    {name:'Legendary', w:1,  mult:2.20},
  ];
  const SLOTS = ['weapon','armor','trinket'];

  function weightedRarity(){
    const sum = RARITY.reduce((s,r)=>s+r.w,0);
    let r = Math.random()*sum;
    for(const it of RARITY){ if((r-=it.w)<=0) return it; }
    return RARITY[0];
  }

  function dps(){
    const relicBonus = 1 + G.relics*0.02;
    let atk = G.hero.atk * relicBonus;
    if(G.equip.weapon) atk *= G.equip.weapon.power;
    let crit = G.hero.crit + (G.equip.trinket?.crit||0);
    let critDmg = G.hero.critDmg/100 + (G.equip.trinket?.critDmg||0);
    let as = clamp(G.hero.atkSpd + (G.equip.armor?.atkSpd||0), 0.2, 20);
    const avg = atk * (1 + clamp(crit/100,0,0.95)* (critDmg-1));
    return avg * as;
  }

  function enemyForStage(stage){
    const isBoss = stage%10===0;
    const base = Math.pow(1.17, stage-1);
    const hp = Math.floor(40*base * (isBoss? 12:1));
    const gold = Math.floor(6*base * (isBoss? 8:1));
    return { name: isBoss? 'Boss' : choice(['Slime','Bat','Wolf','Goblin','Wisp','Golem']),
             maxHP: hp, hp: hp, gold:gold, boss:isBoss };
  }

  function dropLoot(stage){
    const dropChance = clamp(0.18 + stage*0.0015, 0.18, 0.45);
    if(Math.random()>dropChance) return null;
    const rarity = weightedRarity();
    const slot = choice(SLOTS);
    let item = { id:crypto.randomUUID(), name:'', slot, rarity:rarity.name, power:1, crit:0, critDmg:0, atkSpd:0 };
    const p = 1 + (stage/100) * (rarity.mult-1 + 0.4);
    if(slot==='weapon'){ item.name= choice(['çŸ­åŠ','é•·åˆ€','æˆ°æ–§','æ³•æ–','é•·æ§'])+` Â· ${rarity.name}`; item.power = +(p).toFixed(2); }
    if(slot==='armor'){ item.name= choice(['çš®ç”²','é–ç”²','æ¿ç”²','æ³•è¢'])+` Â· ${rarity.name}`; item.atkSpd = +((p-1)/4).toFixed(2); }
    if(slot==='trinket'){ item.name= choice(['æŒ‡ç’°','é …éŠ','è­·ç¬¦'])+` Â· ${rarity.name}`; item.crit = +(Math.min(20,(p-1)*30)).toFixed(1); item.critDmg = +((p-1)*0.8).toFixed(2)+1; }
    return item;
  }

  function log(msg, cls=''){
    const div=document.getElementById('log');
    const p=document.createElement('div');
    if(cls) p.className=cls; p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    div.prepend(p);
    while(div.children.length>120) div.lastChild.remove();
  }

  // ===== UI æ›´æ–° =====
  function syncHeader(){
    document.getElementById('pill-stage').textContent = `Stage ${fmt(G.stage)}`;
    document.getElementById('pill-gold').textContent = `Gold ${fmt(G.gold)}`;
    document.getElementById('pill-relic').textContent = `Relics ${fmt(G.relics)}`;
    document.getElementById('pill-dps').textContent = `DPS ${fmt(dps().toFixed(1))}`;
  }
  function syncHero(){
    document.getElementById('sLevel').textContent = fmt(G.hero.lvl);
    document.getElementById('sATK').textContent = fmt(G.hero.atk);
    document.getElementById('sCrit').textContent = `${G.hero.crit.toFixed(1)}%`;
    document.getElementById('sCritDmg').textContent = `${G.hero.critDmg}%`;
    document.getElementById('sAS').textContent = (G.hero.atkSpd).toFixed(2);
    document.getElementById('sRelic').textContent = `${(G.relics*2).toFixed(0)}%`;
    document.getElementById('sDPS').textContent = fmt(dps().toFixed(1));
    document.getElementById('costATK').textContent = fmt(costATK());
    document.getElementById('costCrit').textContent = fmt(costCrit());
    document.getElementById('costAS').textContent = fmt(costAS());
    document.getElementById('costATK10').textContent = fmt(costATK(10));
  }
  function syncEnemy(){
    const e=G.enemy; if(!e) return;
    document.getElementById('kEnemy').textContent = e.boss? `ğŸ‘‘ ${e.name}`: e.name;
    document.getElementById('kEnemyHP').textContent = `${fmt(Math.max(0,Math.ceil(e.hp)))} / ${fmt(e.maxHP)}`;
    const pct = clamp(e.hp/e.maxHP,0,1)*100; document.getElementById('hpBar').style.width = pct+'%';
    document.getElementById('kStatus').textContent = e.boss? (G.bossTimer>0? `Boss å€’æ•¸ ${G.bossTimer.toFixed(1)}s` : 'Boss å¤±æ•—') : 'å‰é€²ä¸­';
  }

  function renderInventory(){
    const tbody=document.querySelector('#invTable tbody'); tbody.innerHTML='';
    for(const it of G.inv){
      const tr=document.createElement('tr');
      tr.innerHTML = `<td class="rarity-${it.rarity}">${it.name}</td><td>${it.slot}</td><td>${describeItem(it)}</td><td>${it.rarity}</td>`;
      tr.style.cursor='pointer';
      tr.onclick=()=>equipItem(it);
      tbody.appendChild(tr);
    }
    // Equipped display
    const w=G.equip.weapon, a=G.equip.armor, t=G.equip.trinket;
    document.getElementById('gear-weapon').textContent = w? w.name : 'ç„¡';
    document.getElementById('gear-weapon-bonus').textContent = w? `æ­¦å™¨ä¹˜å€ x${w.power}` : 'â€”';
    document.getElementById('gear-armor').textContent = a? a.name : 'ç„¡';
    document.getElementById('gear-armor-bonus').textContent = a? `æ”»é€Ÿ +${a.atkSpd}` : 'â€”';
    document.getElementById('gear-trinket').textContent = t? t.name : 'ç„¡';
    document.getElementById('gear-trinket-bonus').textContent = t? `æš´æ“Šç‡ +${t.crit}% / çˆ†å‚· +${(t.critDmg*100).toFixed(0)}%` : 'â€”';
  }
  function describeItem(it){
    if(it.slot==='weapon') return `æ­¦å™¨ä¹˜å€ x${it.power}`;
    if(it.slot==='armor') return `æ”»é€Ÿ +${it.atkSpd}`;
    if(it.slot==='trinket') return `æš´æ“Šç‡ +${it.crit}% / çˆ†å‚· +${(it.critDmg*100).toFixed(0)}%`;
    return '';
  }

  function equipItem(it){
    G.equip[it.slot]=it; log(`å·²è£å‚™ ${it.name}ï¼ˆ${it.slot}ï¼‰`, 'success');
    syncHero(); renderInventory(); save();
  }

  // ===== ç¶“æ¿Ÿèˆ‡å‡ç´š =====
  function costATK(n=1){
    // å¹¾ä½•ç´šæ•¸æˆæœ¬ï¼Œéš¨ç­‰ç´šèˆ‡å·²è³¼è²·æ”»æ“ŠåŠ›ä¸Šå‡
    const base=10; return Math.floor(base * Math.pow(1.11, (G.hero.atk-10)) * (n===1?1: (n*0.9)) );
  }
  function costCrit(){ return Math.floor(25 * Math.pow(1.18, G.hero.crit)); }
  function costAS(){ return Math.floor(50 * Math.pow(1.22, (G.hero.atkSpd*10-10))); }

  function buy(cost,cb){ if(G.gold>=cost){ G.gold-=cost; cb(); syncHeader(); syncHero(); save(); return true;} log('é‡‘å¹£ä¸è¶³ï¼','danger'); return false; }

  // ===== æ ¸å¿ƒè¿´åœˆ =====
  function ensureEnemy(){ if(!G.enemy){ G.enemy = enemyForStage(G.stage); if(G.enemy.boss) G.bossTimer=30; syncHeader(); syncEnemy(); } }

  function tick(dt){
    if(!G.running) return;
    ensureEnemy();
    const e=G.enemy; if(!e) return;

    // Boss å€’æ•¸
    if(e.boss){ G.bossTimer -= dt; if(G.bossTimer<=0 && e.hp>0){ log('Boss å¤±æ•—ï¼Œå›åˆ°ä¸Šä¸€é—œ', 'danger'); G.stage = Math.max(1, G.stage-1); G.enemy=null; return; } }

    const damage = dps() * dt * G.speed;
    e.hp -= damage;
    if(e.hp<=0){
      // æ“Šæ®º
      G.gold += e.gold; if(G.stage>G.bestStage) G.bestStage = G.stage;
      const loot = dropLoot(G.stage);
      if(loot){ G.inv.push(loot); log(`æ‰è½ï¼š${loot.name}ï¼ˆ${describeItem(loot)}ï¼‰`,'success'); }
      // é€²å…¥ä¸‹ä¸€é—œæˆ–æ–° Boss
      G.stage += 1; G.enemy=null; syncHeader(); renderInventory();
    }
    syncEnemy();
  }

  // ===== é›¢ç·šæ”¶ç›Š =====
  function offlineReward(){
    const now=Date.now();
    const elapsed = clamp((now - (load()?.lastSave || now))/1000, 0, 8*3600); // æœ€å¤š 8 å°æ™‚
    if(elapsed<5) return; // å¤ªçŸ­ç•¥é
    // ä¼°ç®—æ¯æ®ºæ™‚é–“ï¼ˆä»¥æ•µäºº HP / DPSï¼‰
    const e = enemyForStage(G.stage);
    const perKill = Math.max(1.2, e.maxHP / Math.max(1, dps()));
    const kills = Math.floor(elapsed / perKill);
    const gold = kills * e.gold;
    G.gold += gold;
    log(`é›¢ç·šæ”¶ç›Šï¼šæ“Šæ•—ç´„ ${fmt(kills)} åæ•µäººï¼Œç²å¾— ${fmt(gold)} é‡‘å¹£ã€‚`,'success');
  }

  // ===== å­˜æª” =====
  function save(){
    G.lastSave = Date.now(); localStorage.setItem('afk-hero-save', JSON.stringify(G));
  }
  function load(){
    try{ return JSON.parse(localStorage.getItem('afk-hero-save')||'null'); }catch(e){ return null }
  }
  function applySave(S){ if(!S) return; G = Object.assign(G,S); }

  // ===== äº‹ä»¶ç¹«çµ =====
  function bind(){
    document.getElementById('btnStart').onclick=()=>{ G.running=!G.running; log(G.running?'é–‹å§‹æ›æ©Ÿ':'æš«åœ'); };
    document.getElementById('btnFast').onclick=()=>{ G.speed = G.speed>=G.speedMax?1:G.speed+1; document.getElementById('speedLabel').textContent = G.speed; };
    document.getElementById('btnNext').onclick=()=>{ G.stage+=1; G.enemy=null; syncHeader(); };
    document.getElementById('btnRetry').onclick=()=>{ if(G.enemy?.boss){ G.bossTimer=30; G.enemy.hp=G.enemy.maxHP; log('Boss é‡ç½®'); syncEnemy(); }};
    document.getElementById('btnBuyATK').onclick=()=>buy(costATK(),()=>{G.hero.atk+=1;});
    document.getElementById('btnBuyCrit').onclick=()=>buy(costCrit(),()=>{G.hero.crit+=1;});
    document.getElementById('btnBuyAS').onclick=()=>buy(costAS(),()=>{G.hero.atkSpd=+(G.hero.atkSpd+0.1).toFixed(2)});
    document.getElementById('btnAtk10').onclick=()=>buy(costATK(10),()=>{G.hero.atk+=10;});
    document.getElementById('btnAscSpd').onclick=()=>{ if(G.gold>=500){ G.gold-=500; G.speedMax=4; log('å·²è§£é–åŠ é€Ÿä¸Šé™ x4','success'); syncHeader(); save(); } else log('é‡‘å¹£ä¸è¶³','danger') };

    // Tabs
    document.querySelectorAll('.tabs button').forEach(b=>b.onclick=()=>{
      document.querySelectorAll('.tabs button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      const id = b.dataset.tab;
      document.querySelectorAll('.tab').forEach(x=>x.style.display='none');
      document.getElementById('tab-'+id).style.display='block';
    });

    // Prestige
    document.getElementById('btnAscend').onclick=()=>{
      const gain = Math.floor(G.bestStage/20);
      if(gain<=0){ log('å°šæœªé”åˆ°è½‰ç”Ÿé–€æª»ï¼ˆè‡³å°‘æœ€é«˜é—œ 20ï¼‰','danger'); return; }
      G.relics += gain; log(`è½‰ç”ŸæˆåŠŸï¼ç²å¾— ${gain} éºç‰©ã€‚`,'success');
      // reset
      G.stage=1; G.bestStage=1; G.gold=0; G.inv=[]; G.equip={weapon:null,armor:null,trinket:null}; G.enemy=null;
      save(); syncHeader(); syncHero(); renderInventory();
    };

    // Save/Load
    document.getElementById('btnSave').onclick=()=>{ save(); log('å·²æ‰‹å‹•å„²å­˜','success') };
    document.getElementById('btnExport').onclick=()=>{
      const data=btoa(unescape(encodeURIComponent(JSON.stringify(G))));
      navigator.clipboard.writeText(data); log('å­˜æª”å­—ä¸²å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿','success');
    };
    document.getElementById('btnImport').onclick=async()=>{
      const str=prompt('è²¼ä¸ŠåŒ¯å…¥å­—ä¸²ï¼ˆå°‡è¦†è“‹ç›®å‰é€²åº¦ï¼‰');
      if(!str) return; try{ const obj=JSON.parse(decodeURIComponent(escape(atob(str)))); applySave(obj); log('åŒ¯å…¥æˆåŠŸ','success'); G.enemy=null; syncHeader(); syncHero(); renderInventory(); save(); }catch(e){ log('åŒ¯å…¥å¤±æ•—ï¼šå­—ä¸²ä¸æ­£ç¢º','danger'); }
    };
    document.getElementById('btnWipe').onclick=()=>{ if(confirm('ç¢ºå®šæ¸…é™¤å­˜æª”ï¼Ÿæ­¤å‹•ä½œä¸å¯å¾©åŸ')){ localStorage.removeItem('afk-hero-save'); location.reload(); } };
  }

  // ===== åˆå§‹åŒ– =====
  function init(){
    const S=load(); if(S){ applySave(S); }
    offlineReward();
    bind();
    ensureEnemy();
    syncHeader(); syncHero(); renderInventory(); syncEnemy();
    // é è¦½å¯å¾—éºç‰©
    setInterval(()=>{ document.getElementById('relicPreview').textContent = Math.floor(G.bestStage/20); }, 1000);
    // è‡ªå‹•å„²å­˜
    setInterval(()=>save(), 10000);

    // ä¸»è¿´åœˆ
    let prev=performance.now();
    function loop(now){
      const dt = (now-prev)/1000; prev=now;
      tick(dt);
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  }

  init();
  </script>
</body>
</html>
